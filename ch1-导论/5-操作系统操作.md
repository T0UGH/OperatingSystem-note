### 1.5 操作系统操作
---

- 操作系统的合理设计必须保证错误程序不会造成其他程序执行错误

---
#### 1.5.1 双重模式

- 为了确保操作系统的正确执行，必须区分操作系统代码和用户定义代码的执行

- 操作系统的两种模式：
    - 用户模式(user mode)：当用户程序执行时，处于用户模式
    - 系统模式(system mode)：只要操作系统获得了对计算机的控制，它就处于内核模式

- 模式位：计算机硬件用于表示当前模式的位

- 双重模式操作提供了保护操作系统和用户程序不受错误用户程序影响的手段，其实现方法为
    - 将能引起损害的机器指令作为特权指令(privileged instruction)
    - 如果试图在用户模式下执行特权指令，那么硬件并不执行此指令，而是认为此指令非法，并以陷阱(trap)的形式通知操作系统

- 系统调用
    - 为用户程序提供请求操作系统代表用户程序完成预留给操作系统的任务提供了方法
    - 系统调用通常采用陷阱到中断向量中的一个指定位置的方式
    - 当系统调用执行时，硬件会将它作为软件中断
    - 控制权会通过中断向量转交给操作系统的中断处理程序，模式位设置为内核模式
    - 内核检查中断指令以确定发生了什么系统调用
    - 参数表示用户程序请求什么类型的而服务
    - **内核检查参数是否正确和合法，再执行指令**
    - 最后将控制返回到用户程序中系统调用之后的指令

- 定时器
    - 必须确保操作系统能维持对CPU的控制，也必须防止用户程序陷入死循环或不调用系统服务，并且不将控制权返回到操作系统
    - 可以将定时器设置为在给定时间后，产生一个中断来防止这种现象
---
copyleft ! 2018 T0UGH. All rights reserved under the MIT license.