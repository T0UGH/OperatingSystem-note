### 4.4多线程问题
---
#### 4.4.1 系统调用 `fork()` 和 `exec()`
---
- 如果程序中一个线程调用 `fork()`，可能有两种复制方式
    1. 复制所有线程
    2. 只复制调用了系统调用 `fork()` 的线程

- 系统调用 `exec()` 的工作方式是：如果一个线程调用了系统调用 `exec()`，那么`exec()`参数指定的程序会替换整个进程，包括所有线程
---
#### 4.4.2 线程取消 
---
- **线程取消**是在线程完成之前来终止线程的任务

- 目标线程的取消可在两种情况下发生
    1. 异步取消：一个线程立即取消目标线程
    2. 延迟取消：目标线程不断地检查它是否应终止，这允许目标线程有机会以有序的方式来终止自己
--- 
#### 4.4.3 信号处理
---
- 信号在UNIX中用来通知进程某个特定事件已发生了

- 信号具有同样的模式
    1. 信号是由特定事件的发生所产生的
    2. 产生的信号要发送到进程
    3. 一旦发送，信号必须加以处理

- 信号分为同步信号和异步信号
    - 同步信号：信号的产生进程和发送进程是同一进程
    - 当一个信号由运行进程之外的事件产生，那么进程就异步接收这个信号

- 每个信号都有一个**默认信号处理程序**，当处理信号时是在内核中运行的。这个默认动作可以用**用户定义的信号处理程序**来改写

- Windows并不明确提供对信号的支持，但是它们能通过异步过程调用(asynchronous procedure call，APC)来模拟。APC工具允许用户线程指定一个函数以便在用户线程收到特定事件通知时能被调用
---
#### 4.4.4 线程池
---
- 线程池的主要思想是在进程开始时创建一定数量的线程，并放入到池中以等待工作

- 处理逻辑 
    - 当服务器收到请求时，它会唤醒池中的一个线程，并将要处理的请求传递给它
    - 一旦线程完成了服务，它会返回到池中再等待工作
    - 如果池中没有可用的线程，那么服务器会一直等待直到有空线程为止

- 线程池的优点
    1. 通常用现有线程处理请求要比等待创建新的线程要快
    2. 线程池限制了在任何时候可用线程的数量。这对那些不能支持大量并发线程的系统非常重要

- 线程池中线程的数量由系统CPU的数量、物理内存的大小和并发客户请求的期望值等因素决定

---
#### 4.4.5 线程特定数据
---
- 同属一个进程的线程共享进程数据

- **线程特定数据**：在有些情况下每个线程可能需要一定数据的自己的副本，这种数据称为线程特定数据
---
#### 4.4.6 调度程序激活
---
- LWP
    - 许多实现多对多模型或二级模型的系统在用户和内核线程之间设置一种中间数据结构，称为LWP

    - LWP表现为一种应用程序可以调度用户线程来运行的虚拟处理器

    - 每个LWP与一个内核线程相连

    - 如果内核线程阻塞，LWP也阻塞，与LWP相连的用户线程也阻塞

    - 如图
    ![](resource\LWP.jpg)

- 一种解决用户线程库与内核间通信的方法被称为**调度器激活**
---
&copy; 2018 T0UGH. All rights reserved.