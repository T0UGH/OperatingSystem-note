### 11.4 分配方法
---
#### 11.4.1 连续分配

- 简介：连续分配要求每个文件在磁盘上占有一组连续的块

- 优点：
    - 用于访问连续分配文件所需的寻道数最小
    - 支持顺序访问和直接访问

- 问题：
    - 为新文件找到空间
        - 策略：首次适应、最优适应、最差适应
        - 但是这些策略会带来外部碎片问题
    - 确定一个文件需要多少空间
        - 难以确定文件需要多少空间，而且空间不够后难以解决
---
#### 11.3.2 链接分配

- 简介：
    - 采用链接分配，每个文件是磁盘块的链表，磁盘块可分布在磁盘中的任何地方
    - 维护一个目录，每个文件在目录中有一个条目，条目中的内容包括文件第一块的指针和最后一块的指针

- 优点：
    - 采用链接分配没有外部碎片

- 问题：
    - 无法支持文件的直接访问
    - 指针本身占据空间
        - 解决：将多个块组合成簇，按簇而不是块进行分配
    - 可靠性
        - 指针丢失或损坏可能导致链接到其他文件的块上

- 链接分配的变种方案：文件分配表(FAT)
    - 简介
        - 每个卷的开始部分用来存储该FAT
        - 每块在该表中有一项，该表可以通过块号码来索引
        - 目录条目含有文件首块的块号码
        - 根据块号码索引的FAT条目包含下一块的块号码
        - 这条链的最后一块对应的FAT条目为文件结束值(end-of-file,EOF)
        - 未使用的块用0来标识
    - 例如
    - 优点：改善了随机访问的时间，通过读入FAT信息，磁头可以找到任何块的位置
    - 问题：导致大量的磁头寻道时间
---
#### 11.3.3 索引分配

- 简介：
    - 索引分配通过将所有指针放在一起，通过索引块解决了这个问题
    - 每个文件都有其索引块，索引块存储一个磁盘块地址的数组
    - 当创建文件时，索引块的所有指针都设为nil
    - 当首次写入第i块时，先从空闲空间管理器中得到一块，再将其地址写到索引块的第i个条目

- 问题
    - 索引分配浪费空间
        - 索引块指针的开销要大于链接分配指针的开销
    - 如何用索引块存储大文件
        1. 链接方案
            - 将多个索引块链接起来
        2. 多层索引
            - 用第一层索引块指向一组第二层索引块
        3. 组合方案
            - 假设总共15个指针，用头12个指针指向直接块
            - 第13个指针指向一级间接块
            - 第14个指针指向二级间接块
            - 第15个指针指向三级间接块
---
&copy; 2018 T0UGH. All right reserved.