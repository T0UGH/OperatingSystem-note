### 10.1 文件概念
---

- 文件系统提供了在线存储和访问计算机操作系统和所有用户的程序与数据的机制

- 文件系统由两个不同部分组成
    - 一组文件：文件用来存储相关数据
    - 目录结构：目录用于组织系统内的文件并提供有关文件的信息

- 计算机能在不同介质上存储信息，操作系统提供了信息存储的统一逻辑接口

- 操作系统对存储设备的各种属性加以抽象，从而定义了逻辑存储单位，再将文件映射到物理设备上

- 文件是记录在外存上的相关信息的具有名称的集合

- 文件是逻辑外存的最小分配单元，即数据除非在文件中，否则不能写到外存

- 文件表示程序(源形式和目标形式)和数据

- 文件可存储许多不同类型的信息，文件根据其类型具有一定的结构
---
#### 10.1.1 文件属性

- 文件的属性

    - 名称
        - 名称通常为字符串，按照人们容易读取的形式保存
        - 唯一的
        - 在文件命名后，它就独立于进程、用户甚至创建它的系统

    - 标识符
        - 标识文件系统内文件的唯一标签
        - 通常为数字，对人而言这是不可读的文件名称

    - 类型
        - 被支持不同类型的文件系统所使用

    - 位置
        - 该信息为指向设备和设备上文件位置的指针

    - 大小
        - 文件当前大小（以字节、字或块来统计），该属性也可包括文件允许的最大容量值

    - 保护
        - 决定谁能读、写、执行等的访问控制

    - 时间、日期和用户标识
        - 文件创建、上次修改和上次访问的相关信息
        - 这些数据用于保护、安全和使用跟踪

- 所有文件的信息都保存在目录结构中，而目录结构也保存在外存上
---
#### 10.1.2 文件操作

- 文件属于抽象数据类型

- 操作系统提供系统调用对文件进行6种基本操作

- 6种基本操作
    - 创建文件
        1. 在文件系统中为文件找到空间
        2. 在目录中为新文件创建一个条目
    - 写文件
        - 执行一个系统调用，其指明文件名称和要写入文件的内容
        - 系统会搜索目录以查找该文件位置
        - 系统必须为该文件维护一个写位置指针，每当发生写操作，必须更新写指针
    - 读文件
        - 使用系统调用，并指明文件名称和要读入文件块的内存位置
        - 系统会搜索目录以查找该文件位置
        - 系统必须为该文件维护一个读位置指针，每当发生读操作，必须更新读指针
        - 当前文件位置指针：读和写用同一指针
    - 在文件内重定位
        - 搜索目录相关条目，设置当前文件位置指针为给定值
    - 删除文件
        - 在目录中搜索给定名称的文件
        - 释放所有的文件空间以便其他文件使用
        - 删除相应目录条目
    - 截短文件
        - 不改变文件的所有属性
        - 只是将其长度设为0并释放空间

- 文件的打开
    - 介绍
        - 绝大多数文件操作都涉及为给定文件搜索相关目录条目
        - 为了避免不断的搜索，许多系统要求在首次使用文件时，需要使用系统调用open()
        - 操作系统维护一个包含所有打开文件的信息表，打开文件表(open-file table)
        - 当需要一个文件操作时，可通过该表的一个索引指定文件，而不需要搜索
    - 多进程同时打开同一文件
        - 操作系统采用两级内部表：单个进程的表和整个系统的表
        - 单个进程表跟踪单个进程打开的所有文件
        - 单个进程表的每一条目相应地指向整个操作系统的打开文件表
    - 打开文件的信息
        - 文件指针
            - 对打开文件的某个进程来说是唯一的
        - 文件打开计数器
            - 打开计数器跟踪打开和关闭的数量
            - 在最后关闭时，计数器为0，系统删除该条目
        - 文件磁盘位置
            - 用于定位磁盘上文件位置的信息
        - 访问权限
            - 每个进程用一个访问模式打开文件
            - 这种信息保存在单个进程打开的文件表中
- 文件锁
    - 允许一个进程锁住文件以防止其他进程访问它
    - 操作系统提供强制和建议文件加锁机制
        - 强制加锁：操作系统会确保加锁完整性
        - 建议加锁：软件开发人员需要确保适当地获取与释放锁
---
#### 10.1.3 文件类型

- 如果操作系统识别文件类型，那么它就能按合理方式对文件进行操作

- 实现文件类型的常用技术是在文件名称内包含类型
    - 文件名为一组字符，加上圆点，再加上扩展部分
    - 操作系统采用扩展部分来表示文件类型和可用的文件操作类型

- UNIX采用幻数（magic number）来大致表示文件类型

---
#### 10.1.4 文件结构

- 操作系统支持一组文件结构，采用特殊操作处理具有这些结构的文件

- 可支持多个文件结构的操作系统的缺点
    - 操作系统会变大
    - 每个文件可能都需要被定义为操作系统所支持的某一种类型，扩展性差

- 所有操作系统都必须支持至少一种文件结构：可执行文件结构，以便能装入和运行程序
---
#### 10.1.5 内部文件结构

- 块
    - 所有磁盘I/O是按块来执行的，且所有块都有同一大小
    - 但是物理记录大小不可能刚好与所需逻辑记录大小一样长
    - 需要将若干逻辑记录打包放入块中

- 文件可以当作一系列块的组合，所有基本I/O操作都是按块进行的

- 内部碎片：文件的最后一块的部分空间会被浪费，称为内部碎片
---
&copy; 2018 T0UGH. All right reserved.