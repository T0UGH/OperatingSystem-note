### 9.7 内存映射文件
---
#### 9.7.1 基本机制

- 正常情况下，文件每次访问都需要一次系统调用和磁盘访问

- 文件的内存映射(memory mapping)
    - 将文件I/O作为普通内存访问
    - 允许一部分虚拟内存与文件逻辑相关联

- 步骤
    1. 开始的文件访问按普通请求页面调度来进行，会产生页错误
    2. 这样，一页大小的部分文件从文件系统读入物理页
    3. 以后文件的读写就按通常的内存访问来处理
    4. 由于是通过内存操作文件，而不是使用系统调用 `read()` 和 `write()`，从而简化了文件访问和使用

- 对映射到内存中的文件进行写可能不会立即写到磁盘上的文件中

- 多个进程可以允许将同一文件映射到各自的虚拟内存中，以允许数据共享

- 内存映射系统调用还支持写时复制，允许进程共享只读文件

- Solaris中，不管文件是否说明为内存映射，都选择对文件进行内存映射
    - 如果一个文件说明为内存映射
        - 将Solaris将该文件映射到进程的地址空间中
    - 如果一个文件此案用普通系统调用，如`open()`、`read()`、`write()`，都选择对文件进行内存映射，不过是将其映射到内核地址空间
---
#### 9.7.2 内存映射I/O

- 内存映射I/O：一组内存地址专门映射到设备寄存器，对这些内存地址读写就如同对设备寄存器的读写
---
&copy; 2018 T0UGH. All rights reserved.